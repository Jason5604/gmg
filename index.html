<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>成绩查询系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#6366F1',
                        neutral: {
                            light: '#F3F4F6',
                            DEFAULT: '#9CA3AF',
                            dark: '#1F2937'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .shadow-soft {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            }
            .transition-smooth {
                transition: all 0.3s ease-in-out;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="min-h-screen flex flex-col">
        <header class="bg-white shadow-sm py-6">
            <div class="container mx-auto px-4">
                <h1 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-center text-gray-800">
                    <i class="fa fa-graduation-cap text-primary mr-2"></i>成绩查询系统
                </h1>
                <p class="text-center text-gray-500 mt-2">输入考生号或姓名查询成绩</p>
            </div>
        </header>
        <main class="flex-grow container mx-auto px-4 py-8">
            <div id="status-message" class="mb-6 hidden px-4 py-3 rounded-lg transition-smooth"></div>
            <div class="bg-white rounded-xl shadow-soft p-6 mb-8 max-w-2xl mx-auto">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-grow">
                        <label for="query-input" class="block text-sm font-medium text-gray-700 mb-1">考生号或姓名</label>
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
                                <i class="fa fa-search"></i>
                            </span>
                            <input 
                                type="text" 
                                id="query-input" 
                                class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-smooth"
                                placeholder="请输入考生号或姓名"
                            >
                        </div>
                    </div>
                    <div class="flex items-end">
                        <button 
                            id="search-btn" 
                            class="bg-primary hover:bg-primary/90 text-white font-medium py-2 px-6 rounded-lg transition-smooth flex items-center"
                        >
                            <i class="fa fa-search mr-2"></i>查询
                        </button>
                    </div>
                </div>
            </div>
            <div id="loading-indicator" class="hidden text-center py-10">
                <div class="inline-block animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-primary"></div>
                <p class="mt-3 text-gray-600">正在加载数据，请稍候...</p>
            </div>
            <div id="duplicate-selector" class="hidden bg-white rounded-xl shadow-soft p-6 mb-8 max-w-3xl mx-auto">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">找到多个匹配结果，请选择：</h2>
                <div id="duplicate-list" class="space-y-3"></div>
            </div>
            <div id="result-container" class="hidden">
                <div class="bg-white rounded-xl shadow-soft p-6 mb-6">
                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">
                            <span id="student-name" class="mr-2"></span>
                            <span id="student-id" class="text-gray-500 text-lg"></span>
                        </h2>
                        <div class="mt-2 md:mt-0 text-gray-600">
                            <span id="student-school" class="mr-4"></span>
                            <span id="student-class"></span>
                        </div>
                    </div>
                    <div class="text-gray-600">
                        <p>选科：<span id="student-subjects"></span></p>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-soft p-6 mb-6 overflow-x-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">总分(物理)(赋分)</h3>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分数</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向全体名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向区县名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向校名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向班名次</th>
                            </tr>
                        </thead>
                        <tbody id="total-score-physics-remark" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
                <div class="bg-white rounded-xl shadow-soft p-6 mb-6 overflow-x-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">总分(物理)</h3>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分数</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向全体名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向区县名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向校名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向班名次</th>
                            </tr>
                        </thead>
                        <tbody id="total-score-physics" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
                <div class="bg-white rounded-xl shadow-soft p-6 mb-6 overflow-x-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">语文</h3>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分数</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向全体名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向区县名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向校名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向班名次</th>
                            </tr>
                        </thead>
                        <tbody id="chinese-score" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
                <div class="bg-white rounded-xl shadow-soft p-6 mb-6 overflow-x-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">数学</h3>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分数</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向全体名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向区县名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向校名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向班名次</th>
                            </tr>
                        </thead>
                        <tbody id="math-score" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
                <div class="bg-white rounded-xl shadow-soft p-6 mb-6 overflow-x-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">英语</h3>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分数</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向全体名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向区县名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向校名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向班名次</th>
                            </tr>
                        </thead>
                        <tbody id="english-score" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
                <div class="bg-white rounded-xl shadow-soft p-6 mb-6 overflow-x-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">物理</h3>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分数</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向全体名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向区县名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向校名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向班名次</th>
                            </tr>
                        </thead>
                        <tbody id="physics-score" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
                <div class="bg-white rounded-xl shadow-soft p-6 mb-6 overflow-x-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">化学(赋分)</h3>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分数</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">等级</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向全体名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向区县名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向校名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向班名次</th>
                            </tr>
                        </thead>
                        <tbody id="chemistry-remark-score" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
                <div class="bg-white rounded-xl shadow-soft p-6 mb-6 overflow-x-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">化学</h3>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分数</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向全体名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向区县名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向校名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向班名次</th>
                            </tr>
                        </thead>
                        <tbody id="chemistry-score" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
                <div class="bg-white rounded-xl shadow-soft p-6 mb-6 overflow-x-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">生物(赋分)</h3>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分数</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">等级</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向全体名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向区县名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向校名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向班名次</th>
                            </tr>
                        </thead>
                        <tbody id="biology-remark-score" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
                <div class="bg-white rounded-xl shadow-soft p-6 mb-6 overflow-x-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">生物</h3>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分数</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向全体名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向区县名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向校名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向班名次</th>
                            </tr>
                        </thead>
                        <tbody id="biology-score" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
                <div class="bg-white rounded-xl shadow-soft p-6 mb-6 overflow-x-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">政治(赋分)</h3>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分数</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">等级</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向全体名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向区县名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向校名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向班名次</th>
                            </tr>
                        </thead>
                        <tbody id="politics-remark-score" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
                <div class="bg-white rounded-xl shadow-soft p-6 mb-6 overflow-x-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">政治</h3>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分数</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向全体名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向区县名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向校名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向班名次</th>
                            </tr>
                        </thead>
                        <tbody id="politics-score" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
                <div class="bg-white rounded-xl shadow-soft p-6 mb-6 overflow-x-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">地理(赋分)</h3>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分数</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">等级</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向全体名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向区县名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向校名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向班名次</th>
                            </tr>
                        </thead>
                        <tbody id="geography-remark-score" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
                <div class="bg-white rounded-xl shadow-soft p-6 mb-6 overflow-x-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">地理</h3>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分数</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向全体名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向区县名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向校名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向班名次</th>
                            </tr>
                        </thead>
                        <tbody id="geography-score" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
                <div class="bg-white rounded-xl shadow-soft p-6 mb-6 overflow-x-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">小语种</h3>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">分数</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向全体名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向区县名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向校名次</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">方向班名次</th>
                            </tr>
                        </thead>
                        <tbody id="minor-language-score" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
            </div>
        </main>
        <div class="bg-neutral-dark text-white py-6">
            <div class="container mx-auto px-4">
                <h3 class="text-xl font-semibold mb-4">免责声明</h3>
                <div class="space-y-2 text-gray-300">
                    <p>1. 本站用途仅供学生查询联考成绩，无任何盈利收费行为。</p>
                    <p>2. 本站保证不含任何病毒，木马，等破坏用户数据的恶意代码。</p>
                    <p>3. 本站所用数据库均是公开数据并且通过合法途径取得。</p>
                    <p>4. 如果用户继续使用本站即代表信任网站作者，自愿使用本站的功能，并接受本协议所有条款。</p>
                </div>
            </div>
        </div>
    </div>
    <script>
        let studentData = [];
        let isDataLoaded = false;
        const queryInput = document.getElementById('query-input');
        const searchBtn = document.getElementById('search-btn');
        const statusMessage = document.getElementById('status-message');
        const loadingIndicator = document.getElementById('loading-indicator');
        const duplicateSelector = document.getElementById('duplicate-selector');
        const duplicateList = document.getElementById('duplicate-list');
        const resultContainer = document.getElementById('result-container');
        async function init() {
            try {
                showLoading(true);
                await loadStudentData();
                isDataLoaded = true;
                showStatus(`成功加载 ${studentData.length} 条学生数据`, 'success');
            } catch (error) {
                showStatus(`数据加载失败: ${error.message}`, 'error');
                console.error('数据加载错误:', error);
            } finally {
                showLoading(false);
            }
            searchBtn.addEventListener('click', handleSearch);
            queryInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleSearch();
            });
        }
        async function loadStudentData() {
            const response = await fetch('./data.xlsx');
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const arrayBuffer = await response.arrayBuffer();
            const workbook = XLSX.read(arrayBuffer, { type: 'array' });
            const sheetNames = workbook.SheetNames;
            studentData = [];
            for (const sheetName of sheetNames) {
                const worksheet = workbook.Sheets[sheetName];
                // 获取范围
                const range = XLSX.utils.decode_range(worksheet['!ref'] || 'A1:A1');
                // 假设前两行是表头
                const headersRow1 = XLSX.utils.sheet_to_json(worksheet, { header: 1, range: `A1:${XLSX.utils.encode_col(range.e.c)}1` })[0];
                const headersRow2 = XLSX.utils.sheet_to_json(worksheet, { header: 1, range: `A2:${XLSX.utils.encode_col(range.e.c)}2` })[0];
                // 从第三行开始加载数据
                const data = XLSX.utils.sheet_to_json(worksheet, { header: 1, range: `A3:${XLSX.utils.encode_col(range.e.c)}${range.e.r + 1}` });
                // 处理复合表头
                for (let i = 0; i < data.length; i++) {
                    const row = data[i];
                    const student = {};
                    for (let j = 0; j < row.length; j++) {
                        const header1 = headersRow1[j] || '';
                        const header2 = headersRow2[j] || '';
                        const value = row[j];
                        // 构建复合表头
                        let combinedHeader;
                        if (header2.trim()) {
                            combinedHeader = `${header1.trim()}(${header2.trim()})`;
                        } else {
                            combinedHeader = header1.trim();
                        }
                        // 规范化表头，替换空格和特殊字符
                        combinedHeader = combinedHeader.replace(/\s+/g, '_').replace(/[()/]/g, '');
                        student[combinedHeader] = value;
                    }
                    studentData.push(student);
                }
            }
            if (studentData.length === 0) {
                throw new Error('数据库中未找到数据');
            }
            console.log('数据加载完成，共加载', studentData.length, '条记录');
        }
        async function handleSearch() {
            const query = queryInput.value.trim();
            if (!query) {
                showStatus('请输入考生号或姓名', 'warning');
                return;
            }
            if (!isDataLoaded) {
                try {
                    showLoading(true);
                    await loadStudentData();
                    isDataLoaded = true;
                } catch (error) {
                    showStatus(`查询失败: ${error.message}`, 'error');
                    showLoading(false);
                    return;
                }
            }
            try {
                showLoading(true);
                hideDuplicateSelector();
                hideResult();
                const results = searchStudents(query);
                if (results.length === 0) {
                    showStatus('未找到匹配的学生信息', 'info');
                } else if (results.length === 1) {
                    displayStudentResults(results[0]);
                } else {
                    showDuplicateSelector(results);
                }
            } catch (error) {
                showStatus(`查询出错: ${error.message}`, 'error');
                console.error('查询错误:', error);
            } finally {
                showLoading(false);
            }
        }
        function searchStudents(query) {
            return studentData.filter(student => {
                const idMatch = student['考号'] && student['考号'].toString().includes(query);
                const nameMatch = student['姓名'] && student['姓名'].toString().includes(query);
                return idMatch || nameMatch;
            });
        }
        function showDuplicateSelector(students) {
            duplicateList.innerHTML = '';
            students.forEach(student => {
                const item = document.createElement('div');
                item.className = 'p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-smooth';
                item.innerHTML = `
                    <div class="font-medium text-gray-800">${student['姓名'] || '未知'}</div>
                    <div class="text-sm text-gray-600">考号: ${student['考号'] || '未知'}</div>
                    <div class="text-sm text-gray-600">学校: ${student['学校'] || '未知'}, 班级: ${student['班级'] || '未知'}</div>
                `;
                item.addEventListener('click', () => {
                    hideDuplicateSelector();
                    displayStudentResults(student);
                });
                duplicateList.appendChild(item);
            });
            duplicateSelector.classList.remove('hidden');
        }
        function hideDuplicateSelector() {
            duplicateSelector.classList.add('hidden');
            duplicateList.innerHTML = '';
        }
        function displayStudentResults(student) {
            document.getElementById('student-name').textContent = student['姓名'] || '未知';
            document.getElementById('student-id').textContent = `(考号: ${student['考号'] || '未知'})`;
            document.getElementById('student-school').textContent = `学校: ${student['学校'] || '未知'}`;
            document.getElementById('student-class').textContent = `班级: ${student['班级'] || '未知'}`;
            document.getElementById('student-subjects').textContent = student['选科'] || '未填写';
            function populateTable(tableId, scoreKey, rank1Key, rank2Key, rank3Key, rank4Key, gradeKey = null) {
                const tableBody = document.getElementById(tableId);
                tableBody.innerHTML = '';
                const row = document.createElement('tr');
                let cellsHtml = '';
                cellsHtml += `<td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">${student[scoreKey] !== undefined ? student[scoreKey] : '-'}</td>`;
                if (gradeKey !== null) {
                    cellsHtml += `<td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${student[gradeKey] !== undefined ? student[gradeKey] : '-'}</td>`;
                }
                cellsHtml += `
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${student[rank1Key] !== undefined ? student[rank1Key] : '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${student[rank2Key] !== undefined ? student[rank2Key] : '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${student[rank3Key] !== undefined ? student[rank3Key] : '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-500">${student[rank4Key] !== undefined ? student[rank4Key] : '-'}</td>
                `;
                row.innerHTML = cellsHtml;
                tableBody.appendChild(row);
            }
            populateTable(
                'total-score-physics-remark',
                '总分(物理)(赋分)_分数',
                '总分(物理)(赋分)_方向全体名次',
                '总分(物理)(赋分)_方向区县名次',
                '总分(物理)(赋分)_方向校名次',
                '总分(物理)(赋分)_方向班名次'
            );
            populateTable(
                'total-score-physics',
                '总分(物理)_分数',
                '总分(物理)_方向全体名次',
                '总分(物理)_方向区县名次',
                '总分(物理)_方向校名次',
                '总分(物理)_方向班名次'
            );
            populateTable(
                'chinese-score',
                '语文_分数',
                '语文_方向全体名次',
                '语文_方向区县名次',
                '语文_方向校名次',
                '语文_方向班名次'
            );
            populateTable(
                'math-score',
                '数学_分数',
                '数学_方向全体名次',
                '数学_方向区县名次',
                '数学_方向校名次',
                '数学_方向班名次'
            );
            populateTable(
                'english-score',
                '英语_分数',
                '英语_方向全体名次',
                '英语_方向区县名次',
                '英语_方向校名次',
                '英语_方向班名次'
            );
            populateTable(
                'physics-score',
                '物理_分数',
                '物理_方向全体名次',
                '物理_方向区县名次',
                '物理_方向校名次',
                '物理_方向班名次'
            );
            populateTable(
                'chemistry-remark-score',
                '化学(赋分)_分数',
                '化学(赋分)_方向全体名次',
                '化学(赋分)_方向区县名次',
                '化学(赋分)_方向校名次',
                '化学(赋分)_方向班名次',
                '化学(赋分)_等级'
            );
            populateTable(
                'chemistry-score',
                '化学_分数',
                '化学_方向全体名次',
                '化学_方向区县名次',
                '化学_方向校名次',
                '化学_方向班名次'
            );
            populateTable(
                'biology-remark-score',
                '生物(赋分)_分数',
                '生物(赋分)_方向全体名次',
                '生物(赋分)_方向区县名次',
                '生物(赋分)_方向校名次',
                '生物(赋分)_方向班名次',
                '生物(赋分)_等级'
            );
            populateTable(
                'biology-score',
                '生物_分数',
                '生物_方向全体名次',
                '生物_方向区县名次',
                '生物_方向校名次',
                '生物_方向班名次'
            );
            populateTable(
                'politics-remark-score',
                '政治(赋分)_分数',
                '政治(赋分)_方向全体名次',
                '政治(赋分)_方向区县名次',
                '政治(赋分)_方向校名次',
                '政治(赋分)_方向班名次',
                '政治(赋分)_等级'
            );
            populateTable(
                'politics-score',
                '政治_分数',
                '政治_方向全体名次',
                '政治_方向区县名次',
                '政治_方向校名次',
                '政治_方向班名次'
            );
            populateTable(
                'geography-remark-score',
                '地理(赋分)_分数',
                '地理(赋分)_方向全体名次',
                '地理(赋分)_方向区县名次',
                '地理(赋分)_方向校名次',
                '地理(赋分)_方向班名次',
                '地理(赋分)_等级'
            );
            populateTable(
                'geography-score',
                '地理_分数',
                '地理_方向全体名次',
                '地理_方向区县名次',
                '地理_方向校名次',
                '地理_方向班名次'
            );
            populateTable(
                'minor-language-score',
                '小语种_分数',
                '小语种_方向全体名次',
                '小语种_方向区县名次',
                '小语种_方向校名次',
                '小语种_方向班名次'
            );
            resultContainer.classList.remove('hidden');
            resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        function hideResult() {
            resultContainer.classList.add('hidden');
        }
        function showLoading(show) {
            if (show) {
                loadingIndicator.classList.remove('hidden');
                statusMessage.classList.add('hidden');
            } else {
                loadingIndicator.classList.add('hidden');
            }
        }
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'bg-yellow-100', 'text-yellow-800', 'bg-blue-100', 'text-blue-800');
            switch (type) {
                case 'success':
                    statusMessage.classList.add('bg-green-100', 'text-green-800');
                    break;
                case 'error':
                    statusMessage.classList.add('bg-red-100', 'text-red-800');
                    break;
                case 'warning':
                    statusMessage.classList.add('bg-yellow-100', 'text-yellow-800');
                    break;
                case 'info':
                default:
                    statusMessage.classList.add('bg-blue-100', 'text-blue-800');
                    break;
            }
        }
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
