<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>成绩查询系统</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  
  <style>
    .watermark {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: -1;
      opacity: 0.1;
      pointer-events: none;
      transform: rotate(-15deg);
      font-size: 150px;
      font-weight: bold;
      color: #000;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <div class="watermark">@叶天哲</div>
  
  <div class="container mx-auto px-4 py-8 max-w-5xl">
    <header class="text-center mb-8">
      <h1 class="text-3xl font-bold text-blue-600">成绩查询系统</h1>
    </header>
    
    <div class="bg-white p-6 rounded-lg shadow mb-8">
      <form id="searchForm" class="flex flex-col md:flex-row gap-4">
        <div class="flex-1">
          <label class="block text-gray-700 mb-1">考号/姓名</label>
          <input type="text" id="searchVal" required 
            class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div class="flex items-end">
          <button type="submit" 
            class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">
            查询
          </button>
        </div>
      </form>
      <div id="status" class="mt-3 p-3 rounded hidden"></div>
    </div>
    
    <div id="result" class="hidden bg-white p-6 rounded-lg shadow">
      <h2 class="text-xl font-bold mb-4 border-b pb-2">成绩详情</h2>
      
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <div><p class="text-gray-500 text-sm">学校</p><p id="sch"></p></div>
        <div><p class="text-gray-500 text-sm">班级</p><p id="cls"></p></div>
        <div><p class="text-gray-500 text-sm">考号</p><p id="examId"></p></div>
        <div><p class="text-gray-500 text-sm">选科</p><p id="subj"></p></div>
      </div>
      
      <h3 class="font-bold mb-3">总分</h3>
      <div class="grid grid-cols-3 gap-4 mb-6">
        <div><p>总分(物理)(赋分): <span id="total1"></span></p></div>
        <div><p>全体名次: <span id="rank1-1"></span></p></div>
        <div><p>区县名次: <span id="rank1-2"></span></p></div>
        <div><p>总分(物理): <span id="total2"></span></p></div>
        <div><p>全体名次: <span id="rank2-1"></span></p></div>
        <div><p>区县名次: <span id="rank2-2"></span></p></div>
      </div>
      
      <h3 class="font-bold mb-3">单科成绩</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <p>语文: <span id="chinese"></span> (名次: <span id="chineseRank"></span>)</p>
          <p>数学: <span id="math"></span> (名次: <span id="mathRank"></span>)</p>
          <p>英语: <span id="english"></span> (名次: <span id="englishRank"></span>)</p>
          <p>物理: <span id="physics"></span> (名次: <span id="physicsRank"></span>)</p>
        </div>
        <div>
          <p>化学(赋分): <span id="chemistryFen"></span> (等级: <span id="chemistryGrade"></span>)</p>
          <p>生物(赋分): <span id="bioFen"></span> (等级: <span id="bioGrade"></span>)</p>
          <p>政治(赋分): <span id="politicsFen"></span> (等级: <span id="politicsGrade"></span>)</p>
          <p>地理(赋分): <span id="geoFen"></span> (等级: <span id="geoGrade"></span>)</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    let dataList = []; // 存储所有数据（数组形式）

    // 页面加载时加载数据
    document.addEventListener('DOMContentLoaded', loadData);

    async function loadData() {
      showStatus('加载数据中...', 'info');
      try {
        const res = await fetch('./data.xlsx');
        if (!res.ok) throw new Error('文件加载失败');
        
        const ab = await res.arrayBuffer();
        const wb = XLSX.read(ab, { type: 'array' });
        const wsname = wb.SheetNames[0];
        const ws = wb.Sheets[wsname];
        
        // 转换为二维数组（[行][列]），跳过表头行（前2行是表头）
        const jsonData = XLSX.utils.sheet_to_json(ws, { header: 1 });
        dataList = jsonData.slice(2); // 从第3行开始是数据行
        
        if (dataList.length === 0) throw new Error('无数据');
        showStatus(`加载成功（${dataList.length}条）`, 'success');
      } catch (err) {
        showStatus('加载失败: ' + err.message, 'error');
      }
    }

    // 搜索功能
    document.getElementById('searchForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const val = document.getElementById('searchVal').value.trim();
      if (!val) return;
      
      // 查找匹配项（考号是第2列，姓名是第3列）
      const found = dataList.filter(row => 
        row[2]?.toString() === val || row[3]?.toString() === val
      );
      
      if (found.length === 0) {
        showStatus('未找到匹配数据', 'error');
        document.getElementById('result').classList.add('hidden');
      } else if (found.length === 1) {
        showResult(found[0]);
      } else {
        // 重名时显示考号供选择
        let html = '找到多个结果，请选择考号: ';
        found.forEach(row => {
          html += `<button class="ml-2 px-3 py-1 border rounded" onclick="showResult(${JSON.stringify(row)})">${row[2]}</button>`;
        });
        showStatus(html, 'info');
      }
    });

    // 显示成绩（row是当前学生的数据数组）
    function showResult(row) {
      // 解析row数组（按你的Excel列顺序，索引对应关系）
      // 基础信息：0-学校，1-班级，2-考号，3-姓名，4-选科
      document.getElementById('sch').textContent = row[0] || '-';
      document.getElementById('cls').textContent = row[1] || '-';
      document.getElementById('examId').textContent = row[2] || '-';
      document.getElementById('subj').textContent = row[4] || '-';
      
      // 总分相关（索引5开始）
      document.getElementById('total1').textContent = row[5] || '-'; // 总分(物理)(赋分)分数
      document.getElementById('rank1-1').textContent = row[6] || '-'; // 全体名次
      document.getElementById('rank1-2').textContent = row[7] || '-'; // 区县名次
      document.getElementById('total2').textContent = row[10] || '-'; // 总分(物理)分数
      document.getElementById('rank2-1').textContent = row[11] || '-'; // 全体名次
      document.getElementById('rank2-2').textContent = row[12] || '-'; // 区县名次
      
      // 单科成绩
      document.getElementById('chinese').textContent = row[15] || '-'; // 语文分数
      document.getElementById('chineseRank').textContent = row[16] || '-'; // 语文名次
      document.getElementById('math').textContent = row[20] || '-'; // 数学分数
      document.getElementById('mathRank').textContent = row[21] || '-'; // 数学名次
      document.getElementById('english').textContent = row[25] || '-'; // 英语分数
      document.getElementById('englishRank').textContent = row[26] || '-'; // 英语名次
      document.getElementById('physics').textContent = row[30] || '-'; // 物理分数
      document.getElementById('physicsRank').textContent = row[31] || '-'; // 物理名次
      
      // 赋分科目
      document.getElementById('chemistryFen').textContent = row[36] || '-'; // 化学赋分
      document.getElementById('chemistryGrade').textContent = row[37] || '-'; // 化学等级
      document.getElementById('bioFen').textContent = row[43] || '-'; // 生物赋分
      document.getElementById('bioGrade').textContent = row[44] || '-'; // 生物等级
      document.getElementById('politicsFen').textContent = row[50] || '-'; // 政治赋分
      document.getElementById('politicsGrade').textContent = row[51] || '-'; // 政治等级
      document.getElementById('geoFen').textContent = row[57] || '-'; // 地理赋分
      document.getElementById('geoGrade').textContent = row[58] || '-'; // 地理等级
      
      document.getElementById('result').classList.remove('hidden');
      showStatus('', '');
    }

    // 显示状态信息
    function showStatus(txt, type) {
      const el = document.getElementById('status');
      el.innerHTML = txt;
      el.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'bg-blue-100');
      if (type === 'success') el.classList.add('bg-green-100');
      else if (type === 'error') el.classList.add('bg-red-100');
      else if (type === 'info') el.classList.add('bg-blue-100');
      else el.classList.add('hidden');
    }
  </script>
</body>
</html>
